<div class="flex flex-col items-center px-4 md:px-10 mt-10">
  <h1 *ngIf="isEdit; else addMode">✏️ Update Product</h1>
  <ng-template #addMode><h1>➕ Add New Product</h1></ng-template>

  <!-- Form Container -->
  <form class="w-full max-w-md bg-white p-6 rounded shadow-md" [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <div class="sm:flex-row gap-4 items-start sm:items-end">

      <!-- Category -->
      <mat-form-field class="w-full">
        <mat-label>Category</mat-label>
        <mat-select formControlName="categoryId">
          <mat-option *ngFor="let item of categories" [value]="item._id">{{ item.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Brand -->
      <mat-form-field class="w-full">
        <mat-label>Brand</mat-label>
        <mat-select formControlName="brandId">
          <mat-option *ngFor="let item of brands" [value]="item._id">{{ item.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Name -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Name</mat-label>
        <input matInput type="text" placeholder="Enter product name" formControlName="name" />
      </mat-form-field>

      <!-- Description -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Description</mat-label>
        <textarea matInput placeholder="Enter product description" formControlName="description" rows="2"></textarea>
      </mat-form-field>

      <!-- Price -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Price</mat-label>
        <input matInput type="text" placeholder="Enter product price" formControlName="price" />
      </mat-form-field>

      <!-- Discount -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Discount</mat-label>
        <input matInput type="text" placeholder="Enter product discount" formControlName="discount" />
      </mat-form-field>

      <div class="w-full flex gap-8 my-3">
        <mat-checkbox formControlName="isFeatured">Is Featured</mat-checkbox>
        <mat-checkbox formControlName="isNew">Is New</mat-checkbox>
      </div>

      <!-- Images FormArray -->
      <div class="w-full gap-4 items-start sm:items-end" formArrayName="image">
        <div class="flex justify-between items-center mb-3">
          <h4 class="mt-3">Images ➡️</h4>
          <div class="flex gap-4">
            <button type="button" mat-button (click)="addImage()">➕ Add Image</button>
          </div>
        </div>

        <div *ngFor="let ctrl of image.controls; let i = index" class="flex gap-2 items-center mb-2">
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Image {{ i + 1 }}</mat-label>
            <input matInput type="text" [formControlName]="i" placeholder="Image URL or path" />
          </mat-form-field>

          <button type="button"
                  mat-button
                  (click)="removeImage(i)"
                  [disabled]="image.length <= 1"
                  [attr.aria-label]="'Remove image ' + (i + 1)">
            ➖
          </button>

        </div>
      </div>
    </div>

    <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-end mt-4">
      <button type="submit" mat-button class="bg-transparent text-blue-500 px-6 py-4 shadow-lg rounded transition duration-200 ease-in-out" [disabled]="productForm.invalid">
        {{ isEdit ? '✏️ Update' : '➕ Add' }}
      </button>
    </div>
  </form>
</div>
